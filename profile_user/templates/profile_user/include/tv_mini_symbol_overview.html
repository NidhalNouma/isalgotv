<div class="tradingview-widget-container w-full relative">
  <div id="tradingview-mini-symbol-{{ symbol }}"></div>

  <!-- Launch Chart Button -->
  <div class="absolute bottom-2 right-2">
    <a href="https://www.tradingview.com/chart/?symbol={{ symbol }}" target="_blank" rel="noopener noreferrer" class="btn-text border-none">
      Launch Chart<svg class="h-3.5 aspect-auto ml-1" stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
        <polyline points="15 3 21 3 21 9"></polyline>
        <line x1="10" x2="21" y1="14" y2="3"></line>
      </svg>
    </a>
  </div>
</div>

<script>
  ;(function () {
    function createMiniSymbolWidget(theme) {
      const colorTheme = theme === 'dark' ? 'dark' : 'light'
      const containerId = 'tradingview-mini-symbol-{{symbol}}'
      document.getElementById(containerId).innerHTML = '' // Clear old widget
  
      if (typeof TradingView === 'undefined') {
        console.error('TradingView script not loaded.')
        return
      }
  
      new TradingView.MediumWidget({
        container_id: containerId,
        symbols: [['{{symbol}}', '{{symbol}}']],
        dateRanges: ['1d|5', '1m|30', '3m|60', '12m|1D', '60m|1W', 'all|1M'],
        headerFontSize: 'small',
        scaleMode: 'Normal',
        scalePosition: 'right',
        width: '100%',
        height: 350,
        autosize: true,
        colorTheme: colorTheme,
        isTransparent: true,
        showChart: true,
        dateRange: '1D',
        chartType: 'erea',
        chartOnly: false,
        noTimeScale: true,
        hideDateRanges: false,
        hideMarketStatus: false,
        hideSymbolLogo: false,
        scalePosition: 'no',
        scaleMode: 'Normal',
        valuesTracking: '3'
      })
    }
  
    // Load correct theme initially
    const savedTheme = localStorage.getItem('color-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
    createMiniSymbolWidget(savedTheme)
  
    // Recreate widget when theme changes
    const observer = new MutationObserver(() => {
      const isDark = document.documentElement.classList.contains('dark')
      createMiniSymbolWidget(isDark ? 'dark' : 'light')
    })
  
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['class']
    })
  })()
</script>

<style>
    #tradingview-mini-symbol-</style>
