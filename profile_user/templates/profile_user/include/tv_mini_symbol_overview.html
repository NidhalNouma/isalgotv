<!-- TradingView Widget BEGIN -->
<div class="tradingview-widget-container w-full">
  <div id="tradingview-mini-symbol-{{ symbol }}"></div>
</div>

<script>
  ;(function () {
    function createMiniSymbolWidget(theme) {
      const colorTheme = theme === 'dark' ? 'dark' : 'light'
      const containerId = 'tradingview-mini-symbol-{{symbol}}'
      document.getElementById(containerId).innerHTML = '' // Clear old widget
  
      if (typeof TradingView === 'undefined') {
        console.error('TradingView script not loaded.')
        return
      }
  
      new TradingView.MediumWidget({
        container_id: containerId,
        symbols: [['{{symbol}}', '{{symbol}}']],
        dateRanges: ['1d|5', '1m|30', '3m|60', '12m|1D', '60m|1W', 'all|1M'],
        width: '100%',
        height: 350,
        autosize: true,
        colorTheme: colorTheme,
        isTransparent: true,
        showChart: true,
        dateRange: '1D',
        chartType: 'erea',
        chartOnly: false,
        noTimeScale: true,
        hideDateRanges: false,
        hideMarketStatus: false,
        hideSymbolLogo: false,
        scalePosition: 'no',
        scaleMode: 'Normal',
        valuesTracking: '3'
      })
    }
  
    // Load correct theme initially
    const savedTheme = localStorage.getItem('color-theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light')
    createMiniSymbolWidget(savedTheme)
  
    // Recreate widget when theme changes
    const observer = new MutationObserver(() => {
      const isDark = document.documentElement.classList.contains('dark')
      createMiniSymbolWidget(isDark ? 'dark' : 'light')
    })
  
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['class']
    })
  })()
</script>
<!-- TradingView Widget END -->
