{% if user_profile.tradingview_username %}
  <div class="space-x-1 text-sm text-text/80" id="tv-username-connected">
    &#10263;<span class="ml-1.5">Connected as</span>
    <a href="{% url 'settings' %}" class="text-text hover:text-text/80 cursor-pointer font-medium inline-flex items-center">
      {{ user_profile.tradingview_username }}
      <svg class="ml-1 h-3 aspect-auto" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" xmlns="http://www.w3.org/2000/svg">
        <path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h274.9c-2.4-6.8-3.4-14-2.6-21.3l6.8-60.9 1.2-11.1 7.9-7.9 77.3-77.3c-24.5-27.7-60-45.5-99.9-45.5zm45.3 145.3l-6.8 61c-1.1 10.2 7.5 18.8 17.6 17.6l60.9-6.8 137.9-137.9-71.7-71.7-137.9 137.8zM633 268.9L595.1 231c-9.3-9.3-24.5-9.3-33.8 0l-37.8 37.8-4.1 4.1 71.8 71.7 41.8-41.8c9.3-9.4 9.3-24.5 0-33.9z"></path>
      </svg>
    </a>
    {% if strategy not in user_profile.strategies.all %}
      <div class="group inline-flex mt-2">
        <form class="inline-flex" hx-post="{% url 'give_access' strategy.id %}?pg=st" hx-target="#tv-username-connected" hx-swap="outerHTML">
          {% csrf_token %}
          <button class="btn-text border-0 rounded-full font-semibold whitespace-nowrap" type="submit" id="btn-acc-{{ strategy.id }}" onclick="openLoader('', '-acc-{{ strategy.id }}', 'inline-flex');">
            Grant access<svg class="h-4 w-4 ml-1" stroke="currentColor" fill="currentColor" stroke-width="1" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 4c1.654 0 3 1.346 3 3h2c0-2.757-2.243-5-5-5S7 4.243 7 7v2H6c-1.103 0-2 .897-2 2v9c0 1.103.897 2 2 2h12c1.103 0 2-.897 2-2v-9c0-1.103-.897-2-2-2H9V7c0-1.654 1.346-3 3-3zm6.002 16H13v-2.278c.595-.347 1-.985 1-1.722 0-1.103-.897-2-2-2s-2 .897-2 2c0 .736.405 1.375 1 1.722V20H6v-9h12l.002 9z"></path>
            </svg>
          </button>
          <button id="spinner-acc-{{ strategy.id }}" disabled type="button" class="btn-text border-0 rounded-full font-semibold whitespace-nowrap hidden">
            Grant access {% include 'svg/spinner.html' with class='ml-1.5 h-3.5' %}
          </button>
        </form>
      </div>
    {% elif strategy in user_profile.strategies.all %}
      <div class="group inline-flex mt-2">
        <form class="inline-flex" hx-post="{% url 'give_access' strategy.id %}?pg=st" hx-target="#tv-username-connected" hx-swap="outerHTML">
          {% csrf_token %}
          <button class="btn-text bg-profit/10 text-profit/90 border-0 rounded-full font-semibold whitespace-nowrap" type="submit" id="btn-acc-{{ strategy.id }}" onclick="openLoader('', '-acc-{{ strategy.id }}', 'inline-flex');">
            Access granted<svg class="h-4 aspect-auto ml-1.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
              <path d="M21 3v5h-5"></path>
              <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
              <path d="M8 16H3v5"></path>
            </svg>
          </button>
          <button id="spinner-acc-{{ strategy.id }}" disabled type="button" class="btn-text bg-profit/10 text-profit/90 border-0 rounded-full font-semibold whitespace-nowrap hidden">
            Access granted {% include 'svg/spinner.html' with class='ml-1.5 h-3.5' %}
          </button>
        </form>
      </div>
    {% endif %}

    {% if error %}
      {% include 'include/errors.html' with error=error close_id='access_error' class="mt-2" %}
    {% endif %}
  </div>
{% else %}
  <div class="text-text/80 text-sm space-x-1">
    &#10263;<span class="ml-1.5">Set your tradingview username</span>
    <a href="{% url 'settings' %}" class="btn-a font-semibold">here</a>
    <span class="">to get access to this strategy.</span>
  </div>
{% endif %}
