{% load custom_tags %}
<form class="relative w-full max-w-md mx-auto flex flex-col gap-y-4" id="add-{{ broker_type }}-form" hx-post="{% url 'add_crypto_broker_account' broker_type %}" hx-target="#at-accounts" hx-wait="swap">
  <div class="w-full">
    <label for="{{ broker_type }}_name" class="input-label">Name</label>
    <input type="text" id="{{ broker_type }}_name" name="{{ broker_type }}_name" class="input-text w-full" placeholder="Give your account a name" />
  </div>
  <div class="w-full">
    <label for="{{ broker_type }}_apiKey" class="input-label">
      {% if broker_type == 'hyperliquid' %}
        Wallet Address
      {% else %}
        API key
      {% endif %}
    </label>
    <input type="text" id="{{ broker_type }}_apiKey" name="{{ broker_type }}_apiKey" class="input-text w-full" placeholder="{% if broker_type == 'hyperliquid' %}Your wallet address{% else %}Your API key{% endif %}" />
  </div>
  <div class="w-full">
    <label for="{{ broker_type }}_secretKey" class="input-label">Secret key</label>
    <input type="text" id="{{ broker_type }}_secretKey" name="{{ broker_type }}_secretKey" class="input-text w-full" placeholder="Your secret key" />
  </div>
  {% if broker_type == 'bitget' or broker_type == 'kucoin' or broker_type == 'okx' or broker_type == 'apex' %}
    <div class="w-full">
      <label for="{{ broker_type }}_passphrase" class="input-label">Passphrase</label>
      <input type="text" id="{{ broker_type }}_passphrase" name="{{ broker_type }}_pass_phrase" class="input-text w-full" placeholder="Your passphrase" />
    </div>
  {% endif %}
  {% if broker_type == 'bitmart' %}
    <div class="w-full">
      <label for="{{ broker_type }}_passphrase" class="input-label">Memo</label>
      <input type="text" id="{{ broker_type }}_passphrase" name="{{ broker_type }}_pass_phrase" class="input-text w-full" placeholder="Your memo" />
    </div>
  {% endif %}
  {% if broker_type == 'apex' %}
    <div class="w-full">
      <label for="{{ broker_type }}_omni_key" class="input-label">Omni Key</label>
      <input type="text" id="{{ broker_type }}_omni_key" name="{{ broker_type }}_omni_key" class="input-text w-full" placeholder="Your omni key" />
    </div>
  {% endif %}
  <div class="w-full">
    <label for="type" class="input-label">Type</label>

    <ul class="items-center w-full text-sm font-medium text-text/80 bg-text/10 rounded-md">
      {% if broker_type != 'apex' and broker_type != 'hyperliquid' %}
      <li class="w-full">
        <div class="flex items-center ps-3">
          <input id="{{ broker_type }}-type-S" type="radio" value="S" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" checked />
          <label for="{{ broker_type }}-type-S" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">Spot</label>
        </div>
      </li>
      {% endif %}
      {% if broker_type == 'binance' or broker_type == 'bingx' %}
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-M" type="radio" value="U" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" />
            <label for="{{ broker_type }}-type-M" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">USDâ“¢@M</label>
          </div>
        </li>
      {% endif %}
      {% if broker_type == 'binance' or broker_type == 'bingx' %}
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-C" type="radio" value="C" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" />
            <label for="{{ broker_type }}-type-C" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">COIN@M</label>
          </div>
        </li>
      {% endif %}
      {% if broker_type == 'bitget' %}
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-F" type="radio" value="U" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" />
            <label for="{{ broker_type }}-type-F" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">USDT-M</label>
          </div>
        </li>
        {% endif %}
        {% if broker_type == 'bitget' %}
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-C" type="radio" value="C" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" />
            <label for="{{ broker_type }}-type-C" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">COIN-M</label>
          </div>
        </li>
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-Uc" type="radio" value="UC" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" />
            <label for="{{ broker_type }}-type-Uc" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">USDC-M</label>
          </div>
        </li>
      {% endif %} 
      {% if broker_type == 'coinbase' or broker_type == 'okx' or broker_type == 'crypto' or broker_type == 'apex' or broker_type == 'hyperliquid' %}
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-P" type="radio" value="P" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" {% if broker_type == 'apex' or broker_type == 'hyperliquid' %} checked {% endif %} />
            <label for="{{ broker_type }}-type-P" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">{% if broker_type == 'okx' %}Futures{% else %}Perps{% endif %}</label>
          </div>
        </li>
      {% endif %}
      {% if broker_type == 'bitmart' or broker_type == 'bybit' or broker_type == 'kucoin' or broker_type == 'coinbase' or broker_type == 'okx' or broker_type == 'kraken' %}
        <li class="w-full">
          <div class="flex items-center ps-3">
            <input id="{{ broker_type }}-type-F" type="radio" value="F" name="{{ broker_type }}_type" class="w-4 h-4 text-title bg-background border-text border checked:!border checked:!border-text dark:checked:!bg-transparent focus:ring-0" />
            <label for="{{ broker_type }}-type-F" class="w-full py-3 ms-2 input-label mb-0 cursor-pointer">{% if broker_type == 'okx' %}Expiry{% endif %} Futures</label>
          </div>
        </li>
      {% endif %}
    </ul>
  </div>

  {% csrf_token %}
  {% if broker_type != 'apex' and broker_type != 'hyperliquid' %}
  {% include 'include/infos.html' with info='Ensure that the IP address <span class="font-bold mx-0.5">'|add:server_ip|add:'</span> is added to the list of trusted IPs.' class=' w-full' %}
  {% endif %}

  {% if user_profile.automate_access|automate_access:broker_type == False %}
    {% include 'include/broker_payment.html' with title=broker_type price=prices|get_item:'CRYPTO' %}
  {% endif %}

  <div id="add-{{ broker_type }}-form-errors" class=""></div>

  <div class="w-full">
    <button id="btn-add-{{ broker_type }}" type="submit" class="group btn-accent mb-2 w-full mx-auto" onclick="submitStripeElementForm('{{ broker_type }}', 'add-{{ broker_type }}-form-errors', event)">
      Connect<svg xmlns="http://www.w3.org/2000/svg" class="group-hover:scale-110 transition-transform h-4 aspect-square ml-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 17H7A5 5 0 0 1 7 7h2" />
        <path d="M15 7h2a5 5 0 1 1 0 10h-2" />
        <line x1="8" x2="16" y1="12" y2="12" />
      </svg>
    </button>
    <button id="spinner-add-{{ broker_type }}" disabled type="button" class="btn-accent mb-2 w-full mx-auto hidden">
      Connecting {% include 'svg/spinner.html' with class='ml-1.5 h-4' %}
    </button>
  </div>
</form>
