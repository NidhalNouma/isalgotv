{% load static %}
<article class="docs">
    <section id="intro-playground">
        <aside>
            <h3>Playground</h3>
            <p>
                This playground is designed to assist you in creating alerts for any <span>IsAlgo</span> strategy or indicator. Simply follow the steps below to configure your alerts. 
                {% comment %} <br/>If youâ€™re using a strategy or indicator from an external source, <a href="">click here</a> for detailed instructions on how to set up your alerts. {% endcomment %}
            </p>
            <h3 class="mt-6">Preparation Checklist:</h3>
            <p>
            <ul>
                <li>Ensure you are on the correct chart with the desired asset and timeframe.</li>
                <li>Add the strategy/indicator to the chart and confirm it's the tested setup.</li>
                <li>Test your strategy/indicator to verify its performance before proceeding.</li>
            </ul>
            </p>
        </aside>
    </section>

    <div class="mb-4">
        {% include 'include/infos.html' with info="Ensure you thoroughly test the strategy or indicator you plan to automate before initiating the automation process." %}
    </div>

    {% comment %} <div class="mb-4">
        {% include 'include/infos.html' with info="Ensure you thoroughly test the strategy or indicator you plan to automate before initiating the automation process." %}
    </div> {% endcomment %}

    <section id="alert-messages-playground">
        <aside>
            <h3>Alert Messages:</h3>

            <p class="mb-3">
                The alert messages are the message that will be sent on every action taken by the strategy/indicator, whether closing or opening a trade.
                <br/>
                <br/>
                By default the alerts will have the asset name of the tradingview chart and the volume that you set in the strategy/indicator, but you can override them.
            </p>

        
            <p class="pb-5">
                <label class="block mb-1">Asset Name:</label>
                <input class="input-text block w-full max-w-lg" id="symbol-input-{{id}}" type="text" placeholder="e.g., BTCUSD, NAS100" />
                <span class="text-xs !text-text/40">leave empty to use strategy-defined asset</span>
                <br />
                <label class="block mt-2 mb-1">Volume/Amount Per Trade:</label>
                <input class="input-text block w-full max-w-lg" id="volume-input-{{id}}" type="number" placeholder="e.g., 10 " />
                <span class="text-xs !text-text/40">leave empty to use strategy-defined volume</span>
            </p>

            <ul class="space-y-1">
                <li >
                Long Entry:
                <code id="long-entry-{{id}}" onclick="copyPlainText('long-entry-{{id}}')">D=Buy A={{ "{{ticker}" }}} V={{ "{{qty}" }}} ID={{ "{{ID}" }}} <svg class="h-4 aspect-auto inline-flex" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg></code>
                </li>
                <li>
                Short Entry:
                <code id="short-entry-{{id}}" onclick="copyPlainText('short-entry-{{id}}')">D=Sell A={{ "{{ticker}" }}} V={{ "{{qty}" }}} ID={{ "{{ID}" }}} <svg class="h-4 aspect-auto inline-flex" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg></code>
                </li>
                <li>
                Long Exit:
                <code id="long-exit-{{id}}" onclick="copyPlainText('long-exit-{{id}}')">X=Buy A={{ "{{ticker}" }}} P={{ "{{partial_close}" }}} ID={{ "{{ID}" }}} <svg class="h-4 aspect-auto inline-flex" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg></code>
                </li>
                <li>
                Short Exit:
                <code id="short-exit-{{id}}" onclick="copyPlainText('short-exit-{{id}}')">X=Sell A={{ "{{ticker}" }}} P={{ "{{partial_close}" }}} ID={{ "{{ID}" }}} <svg class="h-4 aspect-auto inline-flex" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2" ry="2" /><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2" /></svg></code>
                </li>
            </ul>

            <h3 class="mt-6">Alert Parameters:</h3>
            
            <p class="mb-3">
                <strong>Using Placeholders:</strong> You can use TradingView placeholders (e.g., <code class="inline">{{ "{{ticker}" }}}</code>, <code class="inline">{{ "{{qty}" }}}</code>) to dynamically pull values from your strategy/indicator, or use static values (e.g., <code class="inline">A=BTCUSD</code>, <code class="inline">V=10</code>) to override them.
            </p>

            <p class="mb-2">
                <strong>Required Parameters:</strong>
            </p>
            <ul class="mb-3 space-y-1">
                <li><code class="inline">D</code> or <code class="inline">X</code> - Action: <code class="inline">D=Buy/Sell</code> for Entry, <code class="inline">X=Buy/Sell</code> for Exit</li>
                <li><code class="inline">A</code> - Asset: Use <code class="inline">A={{ "{{ticker}" }}}</code> for strategy asset or <code class="inline">A=BTCUSD</code> for custom</li>
                <li><code class="inline">ID</code> - Unique identifier: Use <code class="inline">ID={{ "{{ID}" }}}</code></li>
                <li><code class="inline">V</code> or <code class="inline">Q</code> - Volume: Use <code class="inline">V={{ "{{qty}" }}}</code> for strategy volume or <code class="inline">V=10</code> for custom</li>
            </ul>

            <p class="mb-2">
                <strong>Optional Parameters:</strong>
            </p>
            <ul class="mb-3 space-y-1">
                <li><code class="inline">P</code> - Partial close: Use <code class="inline">P={{ "{{partial_close}" }}}</code> or <code class="inline">P=50</code> (can include % like <code class="inline">P=50%</code>)</li>
                <li>
                    <code class="inline">R</code> - Reverse signal: Closes any open trade before opening a new one in the opposite direction. This parameter must be added to <strong>both entry and exit alerts</strong> to work correctly.
                    <br/>
                    <span class="text-xs !text-text/60">Example: <code class="inline">D=Buy A={{ "{{ticker}" }}} V=10 ID={{ "{{ID}" }}} R=1</code> and <code class="inline">X=Buy A={{ "{{ticker}" }}} P={{ "{{partial_close}" }}} ID={{ "{{ID}" }}} R=1</code></span>
                    <br/>
                    Change R value if you're using multiple strategies on the same asset to a unique number for each strategy (e.g., R=1, R=2, R=3).
                </li>
            </ul>

            <p class="mb-2">
                <strong>Volume Options:</strong>
            </p>
            <ul class="mb-3">
                <li>Strategy volume: <code class="inline">V={{ "{{qty}" }}}</code></li>
                <li>Static value: <code class="inline">V=10</code></li>
                <li>Math expressions: <code class="inline">V={{ "{{qty}" }}}*2</code> or <code class="inline">V={{ "{{qty}" }}}/10</code></li>
                <li>Rounding: <code class="inline">V={{ "{{qty}" }}}%2</code> (rounds to 2 decimal places)</li>
            </ul>


            <p class="pt-4">
                Copy and paste these alerts into the <span>strategy/indicator's Alerts section</span> in the settings and <span>click OK</span>.
            </p>

            <img onclick="showModalImages(this)"
                src="{% static 'images/docs/automate/strategy-alerts.png' %}"
                alt="Access API Management" />

            
            <p class="pt-2">
                After setting up the alets messages in the strategy/indicator the last step is to create the alert, <a href="{% url 'docs_alerts_create' %}">Click here</a> to see how.
            </p>
        </aside>
    </section>

    <div class="mb-4">
        {% include 'include/infos.html' with info="When changing the asset or volume settings, there is no need to add a new broker. Each broker, once added can handle all available assets and volumes." %}
    </div>

    {% comment %} <section class="mt-4">
        <aside>
            <h3>Need help?</h3>

                <p>If you encounter any issues during the integration process, our support team is here to help. Contact us <a href="{% url 'docs_contactus' %}" target="_blank">here</a>.</p>
        </aside>
    </section>  {% endcomment %}
</article>

<script>
    // Add the input listener
    document.getElementById('symbol-input-{{id}}').addEventListener('input', function(event) {
        const originalText = {};
        const alertIds = [
            'long-entry-{{id}}',
            'short-entry-{{id}}',
            'long-exit-{{id}}',
            'short-exit-{{id}}'
        ];

        const newSymbol = event.target.value.trim(); // Get the text input and trim whitespace
    
        // Update each alert dynamically based on the original text
        alertIds.forEach(id => {
            const codeElement = document.getElementById(id);
            if (codeElement) {
                console.log(codeElement.innerHTML)
                // Replace BTCUSD in the original text with the new symbol
                codeElement.innerHTML =  codeElement.innerHTML.replace(/A=[^\s]+/g, `A=${newSymbol || ("{{ticker}" + "}")}`);
            }
        });
    });

    document.getElementById('volume-input-{{id}}').addEventListener('input', function(event) {
        const originalText = {};
        const alertIds = [
            'long-entry-{{id}}',
            'short-entry-{{id}}',
            'long-exit-{{id}}',
            'short-exit-{{id}}'
        ];

        const newVolume = event.target.value.trim(); // Get the text input and trim whitespace
        
        // Update each alert dynamically based on the original text
        alertIds.forEach(id => {
            const codeElement = document.getElementById(id);
            if (codeElement) {
                // Replace BTCUSD in the original text with the new symbol
                codeElement.innerHTML =  codeElement.innerHTML.replace(/V=[^\s]+/g, `V=${newVolume || ("{{qty}" + "}")}`);
            }
        });
    });
</script>