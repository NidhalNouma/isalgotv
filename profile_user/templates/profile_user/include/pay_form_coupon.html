{% load custom_tags %}

<div id="coupon-pay-{{ title }}">
  <div class="bg-text/5 backdrop-blur-3xl rounded-md p-4 mb-2 text-text">
    {% if current_subscription and title != 'LIFETIME' %}
      {% include 'include/pay_form_price.html' with base_price=base_price coupon_off='-100%' final_price=0 %}
      <p class="mt-2.5 text-[0.85rem] text-text/80">
        &#9737; Next charge is scheduled for <span class="text-text">${{ final_price|trim_zeros }}</span> on <span class="text-text/90">{{ current_subscription.period_end|date:'M d, Y' }}</span>
      </p>
    {% elif not current_subscription and free_trial_days|add:'0' > 0 and title != 'LIFETIME' %}
      {% include 'include/pay_form_price.html' with base_price=base_price coupon_off='-100%' final_price=0 %}
      <p class="mt-2.5 text-[0.85rem] text-text/80">
        &#9737; Next charge is scheduled for <span class="text-text">${{ final_price|trim_zeros }}</span> after the <span class="text-text/90">{{ free_trial_days }} day trial</span>
      </p>
    {% else %}
      {% include 'include/pay_form_price.html' with base_price=base_price coupon_off=coupon_off final_price=final_price %}
    {% endif %}
  </div>

  <div id="coupon-input-{{ title }}" class="mb-4 {% if not coupon_val and not empty %} hidden {% endif %} ">
    <label for="coupon" class="input-label">Coupon code</label>
    <div class="flex items-center w-full gap-2">
      <div class="relative grow">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <svg aria-hidden="true" class="w-5 h-5 text-title/40" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <g id="Barcode">
              <g>
                <path d="M8.066,4.065H3.648a1.732,1.732,0,0,0-.963.189A1.368,1.368,0,0,0,2.066,5.48v4.585a.5.5,0,0,0,1,0V5.785a1.794,1.794,0,0,1,.014-.518c.077-.236.319-.2.514-.2H8.066a.5.5,0,0,0,0-1Z"></path>
                <path d="M2.063,13.937v4.418a1.733,1.733,0,0,0,.189.963,1.369,1.369,0,0,0,1.227.619H8.063a.5.5,0,0,0,0-1H3.783a1.831,1.831,0,0,1-.518-.014c-.236-.077-.2-.319-.2-.514V13.937a.5.5,0,0,0-1,0Z"></path>
                <path d="M15.934,19.935h4.418a1.732,1.732,0,0,0,.963-.189,1.368,1.368,0,0,0,.619-1.226V13.935a.5.5,0,0,0-1,0v4.28a1.794,1.794,0,0,1-.014.518c-.077.236-.319.2-.514.2H15.934a.5.5,0,0,0,0,1Z"></path>
                <path d="M21.937,10.063V5.645a1.733,1.733,0,0,0-.189-.963,1.369,1.369,0,0,0-1.227-.619H15.937a.5.5,0,0,0,0,1h4.28a1.831,1.831,0,0,1,.518.014c.236.077.2.319.2.514v4.472a.5.5,0,0,0,1,0Z"></path>
                <g>
                  <rect x="10.999" y="7.643" width="1" height="8.709" rx="0.5"></rect>
                  <rect x="14.249" y="7.643" width="1" height="8.709" rx="0.5"></rect>
                  <rect x="16.499" y="7.643" width="1" height="8.709" rx="0.5"></rect>
                  <rect x="6.499" y="7.643" width="1" height="8.709" rx="0.5"></rect>
                  <rect x="8.499" y="7.643" width="1.5" height="8.709" rx="0.75"></rect>
                </g>
              </g>
            </g>
          </svg>
        </div>
        <input type="text" name="coupon" id="coupon-{{ title }}" class="block w-full pl-10 input-text" placeholder="10%off" value="{{ coupon_val }}" />
      </div>
      <button id="btn-{{ title }}-coupon" onclick="openLoader('', '-{{ title }}-coupon', 'flex');" class="btn-text">Apply</button>
      <button id="spinner-{{ title }}-coupon" class="btn-text hidden !from-background !to-background" disabled>
        {% include 'svg/spinner.html' with class='ml-1 h-4' %}
      </button>
    </div>

    <div class="mb-2 mt-3" id="{{ title }}-coupon-form-errors">
      {% include 'include/errors.html' with error=error id='error-coupon-submit-{{title}}' %}
      {% include 'include/succes.html' with succes=succes id='succ-coupon-submit-{{title}}' %}
    </div>
  </div>
</div>
