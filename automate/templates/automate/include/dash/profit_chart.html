{% load custom_tags %}
<div class="w-full">
    <div id="currencies-btns" class="space-x-2 space-y-2 mb-2">
        {% for currency, info in data.items %}
            <button id="btn-{{currency}}" onclick="initChart(event, '{{currency}}' ,{{info.data}}, {{info.final_profit}})" class="px-3 py-1 text-sm font-semibold rounded-lg border-transparent border {% if info.final_profit >= 0 %}text-profit bg-profit/10{% else %}text-loss bg-loss/10{% endif %}">{{ info.final_profit|floatformat:8|trim_zeros }} <span class="text-xs ml-0.5 font-normal">{{ currency }}</span></button> 
        {% endfor %}
    </div>
  <canvas id="accountProfitChart-{{ account.id }}" class="!w-full !max-w-full sm:!h-96 !h-72 bg-transparent backdrop-blur-3xl rounded-lg"></canvas>
</div>
<script type="text/javascript">

    const buttons = document.getElementById('currencies-btns').getElementsByTagName('button');

    function currencyBtnClicked(currency, profit) {
        for (let i = 0; i < buttons.length; i++) {
            const btn = buttons[i];
            if(btn.id === 'btn-' + currency) {
                btn.classList.remove('border-transparent');
                if(profit >= 0) {
                    btn.classList.add('border-profit');
                } else {
                    btn.classList.add('border-loss');
                }
            } else {
                btn.classList.remove('border-profit', 'border-loss');
                btn.classList.add('border-transparent');
            }
        }
        event.currentTarget.classList.remove('btn-outline-primary');
        event.currentTarget.classList.add('btn-primary');
    }

    function initChart(event, currency, data, profit) {
        event?.preventDefault();

        console.log('Currency button clicked:', currency, 'with profit:', profit);
        currencyBtnClicked(currency, profit);
        loadAccountProfitCharts('{{ account.id }}', data);
    }

  (function() {
    function autoClickFirstButton() {
        if (buttons.length > 0) {
            //console.log('Auto clicking the first currency button', buttons[0].id);
            buttons[0].click();
        }
    }
    
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', autoClickFirstButton);
    } else {
        autoClickFirstButton();
    }
  })();
</script>