        <div class="flex items-center justify-between ">
          <p class="hidden" id="trades-data-{{ result.id }}">{{ result.list_of_trades|json_script }}</p>
          <canvas id="profitChart-{{ result.id }}" class="!w-full !h-full bg-background backdrop-blur-3xl rounded-lg"></canvas>
        </div>
        <script>
          document.addEventListener('DOMContentLoaded', function () {
            const ctx = document.getElementById('profitChart-{{ result.id }}').getContext('2d')
            // `data` should be your original 2D data array; transform it with your helper function
            // Safely escape Django JSON for inclusion in JS
            const raw = document.getElementById('trades-data-{{ result.id }}').textContent
            const data = JSON.parse(raw)
            const series = transformToTimeProfitForChart(data)
            const minProfit = Math.min(...series.profit)
          
            new Chart(ctx, {
              type: 'line',
              data: {
                labels: series.time,
                datasets: [
                  {
                    data: series.profit,
                    borderWidth: 1,
                    fill: true,
                    // scriptable border color per line segment based on profit sign
                    borderColor: function (context) {
                      const value = context.dataset.data[context.dataIndex]
                      return value < 0 ? getCssVariableColor('--color-loss') : getCssVariableColor('--color-profit')
                    },
                    // color the segment between points based on the end value
                    segment: {
                      borderColor: (ctx) => {
                        const p1 = ctx.p1.parsed.y
                        return p1 < 0 ? getCssVariableColor('--color-loss') : getCssVariableColor('--color-profit')
                      },
                      backgroundColor: (ctx) => {
                        const y = ctx.p1.parsed.y
                        // return semi-transparent fill per segment
                        return y < 0 ? getCssVariableColor('--color-loss', 0.2) : getCssVariableColor('--color-profit', 0.2)
                      }
                    },
                    pointRadius: 0,
                    pointHoverRadius: 0,
                    pointHitRadius: 10
                  }
                ]
              },
              options: {
                animation: false,
                responsive: true,
                layout: {
                  padding: 0
                },
                plugins: {
                  legend: { display: false },
                  tooltip: {
                    enabled: true,
                    displayColors: false,
                    backgroundColor: getCssVariableColor('--color-background'),
                    titleColor: getCssVariableColor('--color-title'),
                    bodyColor: getCssVariableColor('--color-text'),
                    padding: 8,
                    cornerRadius: 4,
                    callbacks: {
                      title: (tooltipItems) => {
                        // Parse Excel serial (assuming UTC) to JS Date
                        const serial = parseFloat(tooltipItems[0].label);
                        // Excel epoch starts at 1899-12-30
                        const utcDays = serial - 25569;
                        const utcMs = utcDays * 86400 * 1000;
                        const date = new Date(utcMs);
                        // Month names for display
                        const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                        // Helper to pad numbers
                        const pad = (n) => n < 10 ? '0' + n : n;
                        const year = date.getUTCFullYear();
                        const month = monthNames[date.getUTCMonth()];
                        const day = pad(date.getUTCDate());
                        const hours = pad(date.getUTCHours());
                        const minutes = pad(date.getUTCMinutes());
                        return `${day} ${month} ${year}   ${hours}:${minutes}`;
                      },
                      label: (tooltipItem) => {
                        // Display the profit value
                        return `Profit: ${tooltipItem.formattedValue}`;
                      }
                    }
                  }
                },
                interaction: {
                  mode: 'nearest',
                  intersect: false
                },
                scales: {
                  x: {
                    display: false,
                    grid: { display: false, drawBorder: false }
                  },
                  y: {
                    min: minProfit,
                    display: false,
                    grid: { display: false, drawBorder: false }
                  }
                }
              }
            })
          })
        </script>